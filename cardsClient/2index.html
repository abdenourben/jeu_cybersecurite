<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>

  <meta charset="utf-8">
  <title>index</title>

  <!-- css -->
  <link rel="stylesheet" href="css/bootstrap.css">
  <link rel="stylesheet" href="css/style.css">


</head>

<body>
  <!--Welcome page-->
  <div id="welcome">
    <div id="wrapper">
      <div id="main">
        <div class="btn-group-vertical">

          <a id="startBtn" class="btn btn-success btn-lg btn-space" role="button">Commencer le jeu</a>

          <button type="button" class="btn btn-danger btn-space btn-lg" data-toggle="modal"
            data-target="#mymodal2">Instructions</button>


          <div class="modal fade" id="mymodal2">
            <div class="modal-dialog modal-lg">
              <div class="modal-content">

                <div class="modal-header">
                  <h1 class="modal-title">Les instructions du jeu</h1>
                  <button type="button" class="close" data-dismiss="modal">×</button>
                </div>

                <div class="modal-body">
                  <h3>Lisez attentivement les instructions</h3>
                  <p>Some text to enable scrolling.. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
                    eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud
                    exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in
                    reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint
                    occaecat
                    cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum consectetur
                    adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim
                    veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                  <p>Some text to enable scrolling.. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
                    eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud
                    exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in
                    reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint
                    occaecat
                    cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum consectetur
                    adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim
                    veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>

                  <p>Some text to enable scrolling.. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
                    eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud
                    exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in
                    reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint
                    occaecat
                    cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum consectetur
                    adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim
                    veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                </div>

                <div class="modal-footer">
                  <button type="button" class="btn btn-success" data-dismiss="modal">J'ai compris</button>
                </div>
              </div>
            </div>
          </div>


          <button type="button" class="btn btn-primary btn-lg btn-space" data-toggle="modal"
            data-target="#mymodal1">Paramètres</button>

          <div class="modal fade" id="mymodal1">

            <div class="modal-dialog">

              <div class="modal-content">
                <div class="modal-header">
                  <h1>Langue</h1>
                </div>

                <div class="modal-body">
                  <h3>Choix de la langue</h3>
                  <div>
                    <select>
                      <option value="Français">Français</option>
                      <option value="Arabe">العربية</option>
                    </select>

                  </div>


                </div>

                <div class="modal-footer">
                  <button type="button" class="btn btn-danger" data-dismiss="modal">Annuler</button>
                  <button type="button" class="btn btn-success" data-dismiss="modal">Appliquer</button>

                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- footer -->
  <footer class="page-footer pt-4 text-light">

    <div class="container-fluid text-center text-md-left">

      <div class="row">

        <div class="col-md-6 mt-md-0 mt-3">

          <h5 class="text-uppercase font-weight-bold">Qui sommes-nous ?</h5>
          <p>Étudiants à l'École nationale Supérieure d'Informatique d'Alger (ESI).</p>

        </div>

        <hr class="clearfix w-100 d-md-none pb-3">

        <div class="col-md-6 mb-md-0 mb-3">

          <h5 class="text-uppercase font-weight-bold">Jeu de la cybersécurité</h5>
          <p>Lorem ipsum, dolor sit amet consectetur adipisicing elit. Optio deserunt fuga perferendis modi earum
            commodi aperiam temporibus quod nulla nesciunt aliquid debitis ullam omnis quos ipsam, aspernatur id
            excepturi hic.</p>

        </div>
      </div>

    </div>

    <div class="footer-copyright text-center py-3" id="color-copyright">© 2019 Copyright :
      <a href="https://esi.dz" style="font-weight: bold; color:#FFFFFF"> esi.dz</a>
    </div>

  </footer>
  <!-- END Welcome page-->
  <!--Board page-->


<div id="board" class="none">




<!-- report instruction --> 
<button  id="button-guide" type="button" class="btn btn-danger btn-space btn-lg" data-toggle="modal"
            data-target="#mymodal3">Guide outils - risques</button>


<div class="modal fade" id="mymodal3">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h1 class="modal-title">Les instructions du jeu</h1>
        <button type="button" class="close" data-dismiss="modal">×</button>
      </div>

      <div class="modal-body">
        <h3>Lisez attentivement les instructions</h3>
        <p>Some text to enable scrolling.. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud
          exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in
          reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint
          occaecat
          cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum consectetur
          adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim
          veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        <p>Some text to enable scrolling.. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud
          exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in
          reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint
          occaecat
          cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum consectetur
          adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim
          veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>

        <p>Some text to enable scrolling.. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud
          exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in
          reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint
          occaecat
          cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum consectetur
          adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim
          veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-success" data-dismiss="modal">J'ai compris</button>
      </div>
    </div>
  </div>
</div>


<!-- end report instruction --> 






  <div id="container1">


      <div class="flexDiv currentPlayer">

        <div class="playerIcon" >
            <img src="images/player_icon.png" />
            <span class="badge">?</span>          
        </div>



        <div class="scenDiv">

        <!-- modal code -->
        <div class="_backdrop"></div>
        <div class="_modal">
            <h1>Lire le scénario</h1>
            <div class="_modal-input">
                <p id="_quote">ddd</p>
            </div>
            <div class="_modal-actions">
                <button type="button" class="_close">X</button>
            </div>
            </div>
            <div class="_demo-container">
                <div class="_modal-control">
                    <img  class="scene" id="c0" src="images/scen.png" alt="scenario" >
                </div>
            </div>

        <!-- end modal code --> 



        <!-- trade modal code -->
        <div class="_backdrop"></div>
        <div class="_modal2">
            <h1>Echange</h1>
            <div class="_modal-input2">
                <p id="_quote">ddd</p>
            </div>
            <div class="_modal-actions2">
                <button type="button" class="_accept">Accepter</button>
                <button type="button" class="_reject">Refuser</button>
            </div>
        </div>
        <!-- end trade modal code -->   
      


        </div> 

        <div class="cartsDiv">
          <p id="c1" class="risk">Carte risque</p>
          <p id="c3">Outil</p>
          <p id="c2" class="risk">Carte risque</p>
          <p id="c4">Outil</p>
        </div>
      </div>
      <div class="flexDiv board2 p0 ">
        <img id="icon0" class="playerIcon none" src="images/player_icon.png" />
        <div class="scenDiv">
            <p id="c0" class="scene "> Carte Scenario</p>
          </div>
          <div class="cartsDiv">
            <p  id="c1" class="risk">Carte risque</p>
            <p  id="c3">Outil</p>
            <p id="c2" class="risk">Carte risque</p>
            <p  id="c4">Outil</p>
          </div>
      </div>
      <div class="flexDiv board2 p1">
        <img id="icon1" class="playerIcon none" src="images/player_icon.png" />
        <div class="scenDiv">
            <p id="c0" class="scene "> Carte Scenario</p>
          </div>
          <div class="cartsDiv">
            <p  id="c1" class="risk">Carte risque</p>
            <p  id="c3">Outil</p>
            <p id="c2" class="risk">Carte risque</p>
            <p  id="c4">Outil</p>
          </div>
      </div>
      <div class="flexDiv board2 p2">
        <img id="icon2" class="playerIcon none" src="images/player_icon.png" />
        <div class="scenDiv">
            <p id="c0" class="scene "> Carte Scenario</p>
          </div>
          <div class="cartsDiv">
            <p  id="c1" class="risk">Carte risque</p>
            <p  id="c3">Outil</p>
            <p id="c2" class="risk">Carte risque</p>
            <p  id="c4">Outil</p>
          </div>
      </div>
      <div class="flexDiv board2 p3">
        <img id="icon3" class="playerIcon none" src="images/player_icon.png" />
        <div class="scenDiv">
            <p id="c0" class="scene "> Carte Scenario</p>
          </div>
          <div class="cartsDiv">
            <p  id="c1" class="risk">Carte risque</p>
            <p  id="c3">Outil</p>
            <p id="c2" class="risk">Carte risque</p>
            <p  id="c4">Outil</p>
          </div>
      </div>
    </div>
  </div>






  <!--Board page-->
  <script src="js/jquery.min.js"></script>

  <script src="js/bootstrap.min.js"></script>
  <script src="js/socket.io.js"></script>
   <script type="text/javascript" src="./js/modal.js">

  </script>
  <script>
    var socket = io.connect('http://localhost:5004');
  </script>
  <script type="text/javascript">
  var players=[];//players IDs list
  let cards = [];//list of cards
  var mySocketId;
    $("#startBtn").on('click', myFunction);
    function myFunction() {

      socket.emit('playerRequest', 'can i start ')
      console.log("start Btn clicked..")
    };
    //socket listening

    //this event fires when the server sends the response about ability to play or not 
    socket.on('playResponse', function (response) {
        if (response.cards) {
            cards = response.cards;
            console.log(cards)
            mySocketId = response.socketId;
            console.log('myId: ' + mySocketId)
            //add already playing players to players list
            response.playersList.forEach(element => {
                var ps = players.filter(x => x.id == element.id)
                if (element.id != mySocketId && ps.length==0) {
                    addPlayerToList(element);
                }
            });
            console.log(players)
            $('#welcome').toggleClass('none');
            $('footer').toggleClass('none');
            $('#board').toggleClass('none');
        
      }
      else{
        console.log('maximum players is 5')
      }
    });
    //this event fires when a player enter to board page and start playing
    socket.on('newPlayer', function (player) {
        console.log('new player:N.' + player.playerNumber + ',id:' + player.id);
        var ps = players.filter(x => x.id == player.id)
        if (player.id == mySocketId || ps.length>0) 
        return;//we dont need to add client's own id
        addPlayerToList(player);
        console.log(players);
        
});
//this event fires when a player go out of the game 
socket.on('playerOut', function (player) {
  var p =players.find(x=>x.id==player.id);
    if(p!=null)
    {
      players =players.filter(x=>x.id!=player.id);
      $('#icon'+p.number).toggleClass('none');
      console.log('player removed')
    }
});
//this event fires when a player asks for a card
socket.on('cardRequest', function (req) {
  //it recieves a card requeste 'req' which have req.from: which is id of player who send the request
                                            // req.cardId: which is id of card requested
  //quote='player with id '+req.from+' requested card with id '+req.cardId
  //outputParagraph.textContent = quote;
  //modal.style.display = 'block';
  //backdrop.style.display = 'block';
  //console.log('player with id '+req.from+' requested card with id '+req.cardId)
  badge.css("display","block");

      });
      socket.on('readCard', function (req) {
          console.log(req.name)
          quote = req.name;
          outputParagraph.text( quote);
          modal.css('display', 'block');
          backdrop.css('display', 'block');
      })
  </script>
  <script>
  //// cards on click handlers
  for (let player = 0; player < 4; player++) {

    for (let card = 0; card < 4; card++) {
        $(".p" + player + " #c" + card).on('click', function () {
            console.log(player)
          sendCardReauest(player, card);
          sendReadRequest(player, card);
      })
        
    }
    
      }
      for (let card = 0; card < 4; card++) {
          $(".currentPlayer" + " #c" + card).on('click', function () {
              socket.emit('readCard', { from: mySocketId, ownerId: mySocketId, cardIndex: card });
          })
      }
  
  </script>
  <script>
    //add player to the players array and show his icon on the board
    function addPlayerToList(player){
      if (players.length == 0) {
          players.push({ number: 0, id: player.id });
          $('#icon'+0).toggleClass('none');
        }
        else {
          for (let index = 0; index < 4; index++) {
            var x = players.find((p) => p.number == index);
            if (x == null) {
              players.push({ number: index, id: player.id });
              $('#icon'+index).toggleClass('none');
              break;
            }
          }
        }
    }
    //send a request to a specific player using his socket id
  function sendCardReauest(playerIndex,cardId){
    var p = players.find(x=>x.number==playerIndex);
    if(p!=null)
    socket.emit('cardRequest',{from:mySocketId,to:p.id,cardId:cardId});
  }
      function sendReadRequest(playerIndex, cardId) {
          var p = players.find(x => x.number == playerIndex);
          if (p != null) {
              console.log(" c" + cardId)
              console.log(playerIndex)
              socket.emit('readCard', { from: mySocketId, ownerId: p.id, cardIndex: cardId });
          }
      }
  </script>
 
 

  <script src="js/modal.js" ></script>


</body>

</html>